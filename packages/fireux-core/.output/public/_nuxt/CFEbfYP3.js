import{p,A as d,B as f,cD as C,cE as l,e as w,cF as g}from"./BVTICooV.js";import{u as m}from"./BC6Im6_J.js";function v(){async function t(){try{const{waitForCurrentUser:s}=p(),r=await s();if(!r||!r.uid){console.warn("⚠️ [ensureCoreUser] No current user found after waiting");return}const e=r.uid,n=d(),a=f(n,"core-users",e);if((await C(a)).exists()){console.log(`✅ [ensureCoreUser] Core user ${e} exists`);return}const{uploadUserAvatar:u}=m(),{setDocument:c}=l(),{appId:i}=w(),U=r.photoURL||await u("img/default-avatar.png",e),o={id:e,email:r.email||"",avatar:U,adminOf:[],userOf:[],created_in:i||"unknown"};await c("core-users",e,o),console.log(`✅ [ensureCoreUser] Created new core user ${e}`),await g()(o)}catch(s){console.error(`❌ [ensureCoreUser] Error: ${s}`)}}return{ensureCoreUser:t}}export{v as useCoreUserEnsure};
